<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="9、Docker Compose - Docker必知必会（从入门到实践）">
    <meta name="description" content="Compose 项目是 Docker 官方的开源项目，基于 Python 编写，用于定义和运行多容器Docker应用程序。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>9、Docker Compose - Docker必知必会 | 悟尘纪</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="悟尘纪" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-material-light.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories/" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags/" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives/" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>时间轴</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/books/" class="waves-effect waves-light">

      
      <i class="fas fa-atlas" style="zoom: 0.6;"></i>
      
      <span>系列文章</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/books/Docker/1-Overview/">
          
          <i class="fab fa-docker" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Docker 必知必会</span>
        </a>
      </li>
      
      <li>
        <a href="/books/Design-Patterns/1-DesignPrinciples/">
          
          <i class="fas fa-layer-group" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>软件设计原则及设计模式</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about/" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends/" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">悟尘纪</div>
        <div class="logo-desc">
            
            人生就是一场修行，上善若水，厚德载物。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			时间轴
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-atlas"></i>
			
			系列文章
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/books/Docker/1-Overview/ " style="margin-left:75px";>
				  
				   <i class="fa fab fa-docker" style="position: absolute;left:50px" ></i>
			      
		          <span>Docker 必知必会</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/books/Design-Patterns/1-DesignPrinciples/ " style="margin-left:75px";>
				  
				   <i class="fa fas fa-layer-group" style="position: absolute;left:50px" ></i>
			      
		          <span>软件设计原则及设计模式</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('本文尚未公开，需输入密码才能访问。')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/2.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">9、Docker Compose - Docker必知必会</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/DevOps/">
                                <span class="chip bg-color">DevOps</span>
                            </a>
                        
                            <a href="/tags/Docker/">
                                <span class="chip bg-color">Docker</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%B7%A5%E5%85%B7/" class="post-category">
                                工具
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-28
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-04-20
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    2.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    12 分
                </div>
                
				
                
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><ul>
<li>本文基于 Docker v19.03版本编写和测试，请留意版本差异。</li>
<li>本文参考/翻译自 Docker 官方文档，更详细的内容可查看 <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">Docker Compose</a></li>
</ul>
<h2 id="一、Docker-Compose-概述"><a href="#一、Docker-Compose-概述" class="headerlink" title="一、Docker Compose 概述"></a>一、Docker Compose 概述</h2><h3 id="1、Docker-Compose-是什么"><a href="#1、Docker-Compose-是什么" class="headerlink" title="1、Docker Compose 是什么"></a>1、Docker Compose 是什么</h3><p> <code>Compose</code> 项目是 <code>Docker</code> 官方的开源项目，基于 Python 编写，用于定义和运行多容器Docker应用程序。Compose 使用 YAML 文件来配置应用程序的服务。然后，使用一个命令，就可以从配置中创建并启动所有服务。</p>
<div class="admonition note"><p>使用 <code>Dockerfile</code> 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。<code>Compose</code> 刚好可以满足这样的需求。</p>
</div>

<p>Compose 有着用于管理应用程序整个生命周期的各种命令:</p>
<ul>
<li>启动、停止和重建服务</li>
<li>查看正在运行的服务的状态</li>
<li>实时查看运行服务的日志输出</li>
<li>仅执行一次命令即可运行整个服务</li>
</ul>
<h3 id="2、Compose-使用步骤"><a href="#2、Compose-使用步骤" class="headerlink" title="2、Compose 使用步骤"></a>2、Compose 使用步骤</h3><p>使用 Compose 基本上有三个步骤:</p>
<ol>
<li>使用 <code>Dockerfile</code> 定义应用程序的环境，这样它就可以在任何地方复制。</li>
<li>用 <code>docker-compose. yml</code> 定义组成应用程序的服务，使其可以在一个独立的环境中一起运行。</li>
<li>运行 <code>docker-Compose up</code> ，Compose 启动并运行您的整个应用程序。</li>
</ol>
<h3 id="3、典型-docker-compose-文件示例"><a href="#3、典型-docker-compose-文件示例" class="headerlink" title="3、典型 docker-compose 文件示例"></a>3、典型 docker-compose 文件示例</h3><p>使用 <code>docker-compose</code> 您主要的任务是编写 <code>docker-compose.yml</code> 文件。以下是一个 <code>WordPress</code> 的 yaml 文件模板：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>        <span class="token comment" spellcheck="true"># 定义版本，不指定默认为版本 1</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>           <span class="token comment" spellcheck="true"># 定义容器，就像 docker run</span>
   <span class="token key atrule">db</span><span class="token punctuation">:</span>              <span class="token comment" spellcheck="true"># 容器名称，也是 network 中 DNS 名称</span>
     <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7   </span><span class="token comment" spellcheck="true"># 镜像，如果自定义镜像可以不指定这个参数，而用 build</span>
     <span class="token key atrule">volumes</span><span class="token punctuation">:</span>       <span class="token comment" spellcheck="true"># 定义数据卷，类似 -v</span>
       <span class="token punctuation">-</span> db_data<span class="token punctuation">:</span>/var/lib/mysql
       <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/lxl80   <span class="token comment" spellcheck="true"># 挂载当前目录到容器中的 /lxl80 目录</span>
     <span class="token key atrule">restart</span><span class="token punctuation">:</span> always  <span class="token comment" spellcheck="true"># 类似 --restart。'no' 默认，不自动重启；always 总是自动重启； on-failure 当失败时自动重启；unless-stopped 除非手动停止，否者一直重启</span>
     <span class="token key atrule">environment</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 定义环境变量，类似 -e</span>
       <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> somewordpress
       <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> wordpress
       <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> wordpress
       <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> wordpress
   <span class="token key atrule">wordpress</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># 第二个容器</span>
     <span class="token key atrule">labels</span><span class="token punctuation">:</span>       <span class="token comment" spellcheck="true"># 为容器添加 Docker 元数据（metadata）信息。</span>
       <span class="token key atrule">cn.lixl.title</span><span class="token punctuation">:</span> <span class="token string">"This label will appear on all containers for the web service"</span>
     <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># 定义容器之间的关系。启动 wordpress 时会先启动 db</span>
       <span class="token punctuation">-</span> db
     <span class="token key atrule">image</span><span class="token punctuation">:</span> wordpress<span class="token punctuation">:</span>latest
     <span class="token key atrule">ports</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 端口，类似 -p</span>
       <span class="token punctuation">-</span> <span class="token string">"8000:80"</span>
     <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
     <span class="token key atrule">environment</span><span class="token punctuation">:</span>
       <span class="token key atrule">WORDPRESS_DB_HOST</span><span class="token punctuation">:</span> db<span class="token punctuation">:</span><span class="token number">3306</span>
       <span class="token key atrule">WORDPRESS_DB_USER</span><span class="token punctuation">:</span> wordpress
       <span class="token key atrule">WORDPRESS_DB_PASSWORD</span><span class="token punctuation">:</span> wordpress

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>          <span class="token comment" spellcheck="true"># 可选，需要创建的数据卷，类似 docker volume create</span>
  <span class="token key atrule">db_data</span><span class="token punctuation">:</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true"># 可选，需要创建的网络，类似 docker network create</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="二、Compose安装及卸载"><a href="#二、Compose安装及卸载" class="headerlink" title="二、Compose安装及卸载"></a>二、Compose安装及卸载</h2><h3 id="1、安装-Compose"><a href="#1、安装-Compose" class="headerlink" title="1、安装 Compose"></a>1、安装 Compose</h3><p><code>Docker Desktop</code> for Mac/Windows 自带 <code>docker-compose</code> 二进制文件，安装 Docker 之后可以直接使用。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ docker-compose --version
docker-compose version 1.24.1, build 4667896b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在 Linux 上的也安装十分简单，从 <a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">官方 GitHub Release</a> 处直接下载编译好的二进制文件即可。</p>
<p>例如，在 Linux 64 位系统上直接下载对应的二进制包。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">></span> /usr/local/bin/docker-compose
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>为 <code>bash</code> 安装 <a href="https://docs.docker.com/compose/completion/" target="_blank" rel="noopener">命令补全</a> 功能：</p>
<pre class="line-numbers language-bash"><code class="language-bash">curl -L https://raw.githubusercontent.com/docker/compose/1.24.1/contrib/completion/bash/docker-compose <span class="token operator">></span> /etc/bash_completion.d/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2、卸载-Compose"><a href="#2、卸载-Compose" class="headerlink" title="2、卸载 Compose"></a>2、卸载 Compose</h3><p>如果基于 <code>curl</code> 安装，通过以下命令卸载Docker Compose ：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">rm</span> /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果基于 <code>pip</code> 安装，通过以下命令卸载Docker Compose ：</p>
<pre class="line-numbers language-bash"><code class="language-bash">pip uninstall docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="三、Docker-Compose-入门"><a href="#三、Docker-Compose-入门" class="headerlink" title="三、Docker Compose 入门"></a>三、Docker Compose 入门</h2><h3 id="关键术语"><a href="#关键术语" class="headerlink" title="关键术语"></a>关键术语</h3><p>   <code>Compose</code> 中有两个重要的概念：</p>
<ul>
<li><p>服务 (<code>service</code>)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</p>
</li>
<li><p>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</p>
</li>
</ul>
<p>可见，一个项目可以由多个服务（容器）关联而成，<code>Compose</code> 面向项目进行管理。</p>
<h3 id="示例应用介绍"><a href="#示例应用介绍" class="headerlink" title="示例应用介绍"></a>示例应用介绍</h3><p>接下来，将构建一个运行在 Docker Compose 上的简单 Python web 应用程序。 该应用程序使用了 Flask 框架，并在 Redis 维护了一个点击计数器。</p>
<p>首选，需要确保已经安装了 Docker 引擎和 Docker Compose。 不需要安装 Python 或 Redis，因为它们都是由 Docker 镜像提供的。</p>
<h3 id="第一步：设置"><a href="#第一步：设置" class="headerlink" title="第一步：设置"></a>第一步：设置</h3><p>定义应用程序的依赖关系：</p>
<p>1、为项目创建一个目录：</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mkdir</span> composetest
<span class="token function">cd</span> composetest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、在项目目录中创建一个名为 app.py 的文件，内容如下：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> time

<span class="token keyword">import</span> redis
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
cache <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'redis'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_hit_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    retries <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> cache<span class="token punctuation">.</span>incr<span class="token punctuation">(</span><span class="token string">'hits'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> redis<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ConnectionError <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
            <span class="token keyword">if</span> retries <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> exc
            retries <span class="token operator">-=</span> <span class="token number">1</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> get_hit_count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World! I have been seen {} times.\n'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在本例中，redis 是应用程序网络上 redis 容器的主机名。 这里使用 Redis 的默认端口，6379。</p>
<p>3、在项目目录中创建另一个叫 <code>requirements.txt</code> 的文件，内容如下：</p>
<pre class="line-numbers language-python"><code class="language-python">flask
redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="第二步：创建一个Dockerfile"><a href="#第二步：创建一个Dockerfile" class="headerlink" title="第二步：创建一个Dockerfile"></a>第二步：创建一个Dockerfile</h3><p>在这个步骤中，将编写一个 <code>Dockerfile</code> 来构建一个 Docker 镜像。镜像包含 Python 应用程序所需的所有依赖项，包括 Python 本身。</p>
<p>在项目目录中，创建一个名为 Dockerfile 的文件，内容如下：</p>
<pre class="line-numbers language-dockerfile"><code class="language-dockerfile">FROM python:3.7-alpine
WORKDIR /code
ENV FLASK_APP app.py
ENV FLASK_RUN_HOST 0.0.0.0
RUN apk add --no-cache gcc musl-dev linux-headers
COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt
COPY . .
CMD ["flask", "run"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这告诉 Docker：</p>
<ul>
<li>基于 Python 3.7 镜像构建</li>
<li>将工作目录设置为 <code>/code</code></li>
<li>设置 <code>flask</code> 命令使用的环境变量</li>
<li>安装 gcc，以便诸如 MarkupSafe 和 SQLAlchemy 之类的 Python 包可以加速编译</li>
<li>复制 <code>requirements.txt</code> 并安装 Python 依赖项</li>
<li>将主机上的项目目录（当前目录）复制到镜像中的 <code>.</code> 工作目录</li>
<li>将容器的默认命令设置为 <code>flask run</code></li>
</ul>
<h3 id="第三步：用-Compose-文件定义服务"><a href="#第三步：用-Compose-文件定义服务" class="headerlink" title="第三步：用 Compose 文件定义服务"></a>第三步：用 Compose 文件定义服务</h3><p>在项目目录中创建一个名为 <code>docker-compose.yml</code> 的文件，内容如下：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .   <span class="token comment" spellcheck="true"># 相当于 docker build .</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5000:5000"</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"redis:alpine"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此 Compose 文件定义了两个服务：<code>web</code> 和 <code>redis</code>。</p>
<p><code>web</code>服务使用从当前目录中的 <code>Dockerfile</code> 构建的映像。然后将容器和主机绑定到公开端口 5000。 此示例服务使用 Flask web 服务器的默认端口5000。</p>
<p>Redis 服务使用从 dockerhub 注册表中提取的公共 Redis 映像。</p>
<h3 id="第四步：用-Compose-构建和运行应用"><a href="#第四步：用-Compose-构建和运行应用" class="headerlink" title="第四步：用 Compose 构建和运行应用"></a>第四步：用 Compose 构建和运行应用</h3><p>1、在项目目录中，通过运行 <code>docker-compose up</code> 启动应用程序。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ docker-compose up
Creating network <span class="token string">"composetest_default"</span> with the default driver
Creating composetest_web_1 <span class="token punctuation">..</span>.
Creating composetest_redis_1 <span class="token punctuation">..</span>.
Creating composetest_web_1
Creating composetest_redis_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Attaching to composetest_web_1, composetest_redis_1
web_1    <span class="token operator">|</span>  * Running on http://0.0.0.0:5000/ <span class="token punctuation">(</span>Press CTRL+C to quit<span class="token punctuation">)</span>
redis_1  <span class="token operator">|</span> 1:C 17 Aug 22:11:10.480 <span class="token comment" spellcheck="true"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
redis_1  <span class="token operator">|</span> 1:C 17 Aug 22:11:10.480 <span class="token comment" spellcheck="true"># Redis version=4.0.1, bits=64, commit=00000000, modified=0, pid=1, just started</span>
redis_1  <span class="token operator">|</span> 1:C 17 Aug 22:11:10.480 <span class="token comment" spellcheck="true"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
web_1    <span class="token operator">|</span>  * Restarting with <span class="token function">stat</span>
redis_1  <span class="token operator">|</span> 1:M 17 Aug 22:11:10.483 * Running mode<span class="token operator">=</span>standalone, port<span class="token operator">=</span>6379.
redis_1  <span class="token operator">|</span> 1:M 17 Aug 22:11:10.483 <span class="token comment" spellcheck="true"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
web_1    <span class="token operator">|</span>  * Debugger is active<span class="token operator">!</span>
redis_1  <span class="token operator">|</span> 1:M 17 Aug 22:11:10.483 <span class="token comment" spellcheck="true"># Server initialized</span>
redis_1  <span class="token operator">|</span> 1:M 17 Aug 22:11:10.483 <span class="token comment" spellcheck="true"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
web_1    <span class="token operator">|</span>  * Debugger PIN: 330-787-903
redis_1  <span class="token operator">|</span> 1:M 17 Aug 22:11:10.483 * Ready to accept connections<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Compose 会拉取一个 Redis 镜像，为您的代码构建一个镜像，并启动您定义的服务。 在这种情况下，代码会在构建时静态复制到镜像中。</p>
<p>2、在浏览器中输入 <a href="http://localhost:5000/" target="_blank" rel="noopener">http://localhost:5000/</a> ，查看该应用程序的运行情况。</p>
<p>您应该在浏览器中看到一条消息，内容为：</p>
<pre class="line-numbers language-html"><code class="language-html">Hello World! I have been seen 1 times.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、刷新页面，数字应该会递增。</p>
<pre class="line-numbers language-html"><code class="language-html">Hello World! I have been seen 2 times.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、切换到另一个终端窗口，键入 <code>docker image ls</code> 查看本地镜像。此时列出的镜像应返回 <code>redis</code> 和 <code>composetest_web</code> 。</p>
<p>5、要停止应用程序，可以在另一个终端中进入项目目录运行 <code>docker-compose stop</code>，或者在启动应用程序的原始终端中按 <code>ctrl + c</code>。如果要停止并清除数据，以便再次启动后重新计数，可以执行 ``docker-compose down`。</p>
<h3 id="第五步：编辑-Compose-文件添加挂载"><a href="#第五步：编辑-Compose-文件添加挂载" class="headerlink" title="第五步：编辑 Compose 文件添加挂载"></a>第五步：编辑 Compose 文件添加挂载</h3><p>在项目目录中编辑 <code>docker-compose. yml</code>，为 web 服务添加一个 <code>bind mount</code>：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5000:5000"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/code
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">FLASK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"redis:alpine"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>新增加 <code>volumes</code> 配置，将主机上的项目目录（当前目录）安装到容器内部的 <code>/code</code> 目录，使您可以即时修改代码，而不必重建镜像。新增 <code>environment</code> 键设置了 <code>FLASK_ENV</code> 环境变量，指示 <code>flask run</code> 要在开发模式下运行并在更改时重新加载代码。此模式仅应在开发中使用。</p>
<h3 id="第六步：重新构建并运行"><a href="#第六步：重新构建并运行" class="headerlink" title="第六步：重新构建并运行"></a>第六步：重新构建并运行</h3><p>从项目目录中，先输入 <code>docker-compose stop</code> 停止营业，然后输入 <code>docker-Compose up</code> 以构建带有更新的 Compose 文件的应用程序，并运行它。</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ docker-compose stop
Stopping composetest_web_1   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Stopping composetest_redis_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
$ docker-compose up
Recreating composetest_web_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Starting composetest_redis_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Attaching to composetest_redis_1, composetest_web_1
redis_1  <span class="token operator">|</span> 1:C 17 Apr 2020 02:25:49.466 <span class="token comment" spellcheck="true"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
web_1    <span class="token operator">|</span>  * Serving Flask app <span class="token string">"app.py"</span> <span class="token punctuation">(</span>lazy loading<span class="token punctuation">)</span>
web_1    <span class="token operator">|</span>  * Environment: development
web_1    <span class="token operator">|</span>  * Debug mode: on
web_1    <span class="token operator">|</span>  * Running on http://0.0.0.0:5000/ <span class="token punctuation">(</span>Press CTRL+C to quit<span class="token punctuation">)</span>
web_1    <span class="token operator">|</span>  * Restarting with <span class="token function">stat</span>
web_1    <span class="token operator">|</span>  * Debugger is active<span class="token operator">!</span>
web_1    <span class="token operator">|</span>  * Debugger PIN: 143-909-154<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再次检查浏览器中的 Hello World 提示消息，并刷新以查看计数增量。</p>
<blockquote>
<p>如果出现运行时错误指示找不到应用程序文件，拒绝卷安装或服务无法启动，请尝试启用文件或驱动器共享。有关更多信息，请参阅 Docker for Mac 上的 <a href="https://docs.docker.com/docker-for-mac/#file-sharing" target="_blank" rel="noopener">文件共享</a> 章节。</p>
</blockquote>
<h3 id="第七步：更新应用程序"><a href="#第七步：更新应用程序" class="headerlink" title="第七步：更新应用程序"></a>第七步：更新应用程序</h3><p>因为现在应用程序代码是使用卷安装到容器中的，所以可以对代码进行更改并立即生效，而无需重建镜像。</p>
<ol>
<li><p>更改 <code>app.py</code> 中的提示语并保存。例如，将 <code>Hello World!</code> 更改为 <code>Hello from Docker!</code> ：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">return</span> <span class="token string">'Hello from Docker! I have been seen {} times.\n'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>在浏览器中刷新应用。会发现提示语已更新，并且计数器仍在增加。</p>
</li>
</ol>
<h3 id="第八步：尝试其它命令"><a href="#第八步：尝试其它命令" class="headerlink" title="第八步：尝试其它命令"></a>第八步：尝试其它命令</h3><p>如果要让服务在后台运行，可以将 <code>-d</code> 参数（用于“分离”模式）传递给 <code>docker-compose up</code> ，并用 <code>docker-compose ps</code> 查看当前正在运行的内容：</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ docker-compose up  -d
Starting composetest_web_1   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Starting composetest_redis_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
$ docker-compose <span class="token function">ps</span>
       Name                      Command               State           Ports
-------------------------------------------------------------------------------------
composetest_redis_1   docker-entrypoint.sh redis <span class="token punctuation">..</span>.   Up      6379/tcp
composetest_web_1     flask run                        Up      0.0.0.0:5000-<span class="token operator">></span>5000/tcp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>docker-compose run</code> 命令允许为服务运行一次性命令。 例如，查看 <code>web</code> 服务可用的环境变量：</p>
<pre class="line-numbers language-bash"><code class="language-bash">$ docker-compose run web <span class="token function">env</span>
PATH<span class="token operator">=</span>/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME<span class="token operator">=</span>4b3f1e39dc5d
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
FLASK_APP<span class="token operator">=</span>app.py
FLASK_RUN_HOST<span class="token operator">=</span>0.0.0.0
HOME<span class="token operator">=</span>/root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>请参阅 <code>docker-compose --help</code> 以查看其他可用命令。您还可以为 bash 和 zsh shell 安装 <a href="https://docs.docker.com/compose/completion/" target="_blank" rel="noopener">命令补全</a> 功能，这将将自动提示可用的命令。</p>
<h2 id="四、Compose-进阶"><a href="#四、Compose-进阶" class="headerlink" title="四、Compose 进阶"></a>四、Compose 进阶</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">docs.docker.com</a></li>
</ul>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.lixl.cn" rel="external nofollow noreferrer">悟尘</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                    </span>
                <span class="reprint-info">
                    <a href="https://www.lixl.cn/2020/022828889.html">https://www.lixl.cn/2020/022828889.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-ND 4.0</a>
                    许可协议，转载请注明来源
                    <a href="https://www.lixl.cn" target="_blank">悟尘纪</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        var selection = window.getSelection();
        if (('' + selection).length >= Number.parseInt('50')) {
            let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
            M.toast({html: toastHTML});
        }
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/DevOps/">
                                    <span class="chip bg-color">DevOps</span>
                                </a>
                            
                                <a href="/tags/Docker/">
                                    <span class="chip bg-color">Docker</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="wechat,weibo,qq,qzone,douban,twitter,facebook,google,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'd032ec0dfbe5a4b4ec6f',
        clientSecret: 'afe793d53f24ebd7f53d0eb4dd21f3bc706dab06',
        repo: 'site',
        owner: 'lxl80',
        admin: "lxl80",
        id: '2020-02-28T18-06-29',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/030137160.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="10、Docker 常用命令 - Docker必知必会">
                        
                        <span class="card-title">10、Docker 常用命令 - Docker必知必会</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            10、Docker 常用命令 - Docker必知必会（从入门到实践）
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-03-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%B7%A5%E5%85%B7/" class="post-category">
                                    工具
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/DevOps/">
                        <span class="chip bg-color">DevOps</span>
                    </a>
                    
                    <a href="/tags/Docker/">
                        <span class="chip bg-color">Docker</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/022722120.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="8、多阶段构建镜像 - Docker必知必会">
                        
                        <span class="card-title">8、多阶段构建镜像 - Docker必知必会</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            8、多阶段构建镜像 - Docker必知必会（从入门到实践）
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%B7%A5%E5%85%B7/" class="post-category">
                                    工具
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/DevOps/">
                        <span class="chip bg-color">DevOps</span>
                    </a>
                    
                    <a href="/tags/Docker/">
                        <span class="chip bg-color">Docker</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('50')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 悟尘纪<br />'
            + '文章作者: 悟尘<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归 [悟尘](http://lixl.cn) 所有，采用 CC BY-NC-ND 4.0 许可协议，转载请注明来源！';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            &copy;
            <span id="year">2019</span>
            <a href="https://www.lixl.cn" target="_blank">悟尘</a>
            &nbsp;|&nbsp;&nbsp;基于&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> 的
            &nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a> 主题构建
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;&nbsp;<i class="far fa-eye"></i>&nbsp;PV:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;&nbsp;<i class="fas fa-users"></i>&nbsp;UV:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;
            </span>
            
            
            
            &nbsp;|&nbsp;&nbsp;<span id="icp">
                <a href="http://www.beian.miit.gov.cn/" target="_blank">冀ICP备20001325号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lxl80/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:me@lixl.cn" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=369888789" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 369888789" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?7e0bedc93e9b2cc20cfa835875bef2d6";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
