<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Electron构建跨平台应用">
    <meta name="description" content="Electron用HTML，CSS和JavaScript来构建跨平台桌面应用程序，将Chromium和Node.js合并到同一个运行时环境中，并将其打包为Mac，Windows和Linux系统下的应用。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Electron构建跨平台应用 | 悟尘记</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>时间轴</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">悟尘记</div>
        <div class="logo-desc">
            
            人生就是一场修行，上善若水，厚德载物。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			时间轴
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('本文尚未公开，需输入密码才能访问。')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://pic.lixl.cn/2020/20200219103814.png/w1280')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Electron构建跨平台应用</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Node-js/">
                                <span class="chip bg-color">Node.js</span>
                            </a>
                        
                            <a href="/tags/Electron/">
                                <span class="chip bg-color">Electron</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/后端/" class="post-category">
                                后端
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-19
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    37 分
                </div>
                
				
                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="一、Electron-简介"><a href="#一、Electron-简介" class="headerlink" title="一、Electron 简介"></a>一、Electron 简介</h2><p>Electron](<a href="https://electronjs.org" target="_blank" rel="noopener">https://electronjs.org</a>) 是由Github开发，用HTML，CSS和JavaScript来构建跨平台桌面应用程序的一个开源库。 Electron通过将 <a href="https://www.chromium.org/Home" target="_blank" rel="noopener">Chromium</a> 和 <a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a> 合并到同一个运行时环境中，并将其打包为Mac，Windows和Linux系统下的应用来实现这一目的。</p>
<p><img src="../../../static/2020/components.png" alt="Electron components"></p>
<p>最初为 GitHub 开发 Atom 编辑器, 目前已成为开源开发者、初创企业和老牌公司常用的开发工具。 <a href="https://electronjs.org/apps" target="_blank" rel="noopener">看看谁在使用Electron </a>。</p>
<h3 id="Electron-发展历程"><a href="#Electron-发展历程" class="headerlink" title="Electron 发展历程"></a>Electron 发展历程</h3><table>
<thead>
<tr>
<th style="text-align:left"><strong>2013年4月</strong></th>
<th style="text-align:left"><a href="https://github.com/electron/electron/commit/6ef8875b1e93787fa9759f602e7880f28e8e6b45" target="_blank" rel="noopener">Atom Shell 项目启动</a> 。</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>2014年5月</strong></td>
<td style="text-align:left"><a href="https://blog.atom.io/2014/05/06/atom-is-now-open-source.html" target="_blank" rel="noopener">Atom Shell 被开源</a> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>2015年4月</strong></td>
<td style="text-align:left"><a href="https://github.com/electron/electron/pull/1389" target="_blank" rel="noopener">Atom Shell 被重命名为 Electron</a> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>2016年5月</strong></td>
<td style="text-align:left"><a href="https://electronjs.org/blog/electron-1-0" target="_blank" rel="noopener">Electron 发布了 <code>v1.0.0</code> 版本</a> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>2016年5月</strong></td>
<td style="text-align:left"><a href="https://www.electronjs.org/docs/tutorial/mac-app-store-submission-guide" target="_blank" rel="noopener">Electron 构建的应用程序可上架 Mac App Store</a> 。</td>
</tr>
<tr>
<td style="text-align:left"><strong>2016年8月</strong></td>
<td style="text-align:left"><a href="https://www.electronjs.org/docs/tutorial/windows-store-guide" target="_blank" rel="noopener">Windows Store 支持 Electron 构建的应用程序</a> 。</td>
</tr>
</tbody>
</table>
<h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p><strong>1. 安装 electron</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g electron
</code></pre>
<p><strong>2. 克隆一个仓库、快速启动一个项目</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 克隆示例项目的仓库</span>
<span class="token function">git</span> clone https://github.com/electron/electron-quick-start

<span class="token comment" spellcheck="true"># 进入这个仓库</span>
<span class="token function">cd</span> electron-quick-start

<span class="token comment" spellcheck="true"># 安装依赖并运行</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> start
</code></pre>
<p><strong>3. 手动搭建一个 electron 项目</strong></p>
<ol>
<li>新建一个项目目录 例如: <code>electrondemo01</code></li>
<li>在 <code>electrondemo01</code> 目录下面新建三个文件: <code>index.html</code>、<code>main.js</code> 、<code>package.json</code></li>
<li><code>index.html</code> 里面用 <code>css</code> 进行布局（以前怎么写现在还是怎么写）</li>
<li>在 <code>main.js</code> 中写如下代码：</li>
</ol>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> electron <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//electron 对象的引用</span>
<span class="token keyword">const</span> app<span class="token operator">=</span>electron<span class="token punctuation">.</span>app<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//BrowserWindow 类的引用</span>
<span class="token keyword">const</span> BrowserWindow<span class="token operator">=</span>electron<span class="token punctuation">.</span>BrowserWindow<span class="token punctuation">;</span>

<span class="token keyword">let</span> mainWindow<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//监听应用准备完成的事件 app.on('ready',function(){</span>

<span class="token comment" spellcheck="true">//监听应用准备完成的事件</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//创建窗口</span>
    mainWindow<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">600</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> mainWindow<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mainWindow<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mainWindow <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//监听所有窗口关闭的事件 </span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-all-closed'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// On OS X it is common for applications and their menu bar // to stay active until the user quits explicitly with Cmd + Q </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">!==</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ol>
<li>运行</li>
</ol>
<pre class=" language-bash"><code class="language-bash">electron <span class="token keyword">.</span> <span class="token comment" spellcheck="true">#注意:命令后面有个点</span>
</code></pre>
<p><strong>4. electron-forge 搭建一个 electron 项目</strong></p>
<blockquote>
<p><code>electron-forge</code> 相当于 <code>electron</code> 的一个脚手架，可以让我们更方便的创建、运行、打包 <code>electron</code> 项目</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g electron-forge 

electron-forge init my-new-app 

<span class="token function">cd</span> my-new-app

<span class="token function">npm</span> start
</code></pre>
<h2 id="三、Electron-运行流程"><a href="#三、Electron-运行流程" class="headerlink" title="三、Electron 运行流程"></a>三、Electron 运行流程</h2><h3 id="1-Electron-运行的流程"><a href="#1-Electron-运行的流程" class="headerlink" title="1 Electron 运行的流程"></a>1 Electron 运行的流程</h3><p><img src="../../../static/2020/app-files.png" alt="Electron app components diagram"></p>
<h3 id="2-Electron-主进程和渲染进程"><a href="#2-Electron-主进程和渲染进程" class="headerlink" title="2 Electron 主进程和渲染进程"></a>2 Electron 主进程和渲染进程</h3><ul>
<li><p><code>Electron</code> 运行 <code>package.json</code> 的 <code>main</code> 脚本的进程被称为主进程。</p>
</li>
<li><p>在主进程中运行的脚本通过创建 <code>web</code> 页面来展示用户界面。 一个 <code>Electron</code> 应用总是有且只有一个主进程。</p>
</li>
<li><p>由于 <code>Electron</code> 使用了 <code>Chromium</code>(谷歌浏览器)来展示 <code>web</code> 页面，所以 <code>Chromium</code> 的 多进程架构也被使用到。 每个 <code>Electron</code> 中的 <code>web</code> 页面运行在它自己的渲染进程中。</p>
</li>
<li><p>主进程使用 <code>BrowserWindow</code> 实例创建页面。每个 <code>BrowserWindow</code> 实例都在自己的渲 染进程里运行页面。 当一个 <code>BrowserWindow</code>实例被销毁后，相应的渲染进程也会被终止。</p>
</li>
</ul>
<h3 id="3-Electron-渲染进程中通过-Nodejs-读取本地文件"><a href="#3-Electron-渲染进程中通过-Nodejs-读取本地文件" class="headerlink" title="3 Electron 渲染进程中通过 Nodejs 读取本地文件"></a>3 Electron 渲染进程中通过 Nodejs 读取本地文件</h3><blockquote>
<p>在普通的浏览器中，<code>web</code>页面通常在一个沙盒环境中运行，不被允许去接触原生的资源。 然而 <code>Electron</code> 的用户在 <code>Node.js</code> 的 <code>API</code>支持下可以在页面中和操作系统进行一些底层交互。<br><code>Nodejs</code> 在主进程和渲染进程中都可以使用。渲染进程因为安全限制，不能直接操作生 <code>GUI</code>。虽然如此，因为集成了 Nodejs，渲染进程也有了操作系统底层 <code>API</code>的能力，<code>Nodejs</code> 中常用的 <code>Path</code>、<code>fs</code>、<code>Crypto</code> 等模块在 <code>Electron</code> 可以直接使用，方便我们处理链接、路径、 文件 <code>MD5</code> 等，同时 <code>npm</code> 还有成千上万的模块供我们选择。</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        content<span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="4-Electron-开启调试模式"><a href="#4-Electron-开启调试模式" class="headerlink" title="4 Electron 开启调试模式"></a>4 Electron 开启调试模式</h3><pre class=" language-js"><code class="language-js">mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="四、Electron-模块介绍"><a href="#四、Electron-模块介绍" class="headerlink" title="四、Electron 模块介绍"></a>四、Electron 模块介绍</h2><blockquote>
<p><code>Electron</code> 模块介绍、<code>remote</code> 模块、通 过 <code>BrowserWindow</code> 打开新窗口</p>
</blockquote>
<h3 id="1-Electron-主进程和渲染进程中的模块"><a href="#1-Electron-主进程和渲染进程中的模块" class="headerlink" title="1 Electron 主进程和渲染进程中的模块"></a>1 Electron 主进程和渲染进程中的模块</h3><p><img src="../../../static/2020/52.png" alt="img"></p>
<h3 id="2-Electron-remote-模块"><a href="#2-Electron-remote-模块" class="headerlink" title="2 Electron remote 模块"></a>2 Electron remote 模块</h3><blockquote>
<p><code>remote</code> 模块提供了一种在渲染进程(网页)和主进程之间进行进程间通讯(<code>IPC</code>)的简便途径。在 <code>Electron</code> 中, 与 <code>GUI</code> 相关的模块(如 <code>dialog</code>, <code>menu</code> 等)只存在于主进程，而不在渲染进程中 。为了能从渲染进程中使用它们，需要用<code>ipc</code>模块来给主进程发送进程间消息。使用 <code>remote</code> 模块，可以调用主进程对象的方法，而无需显式地发送进程间消息，这类似于 <code>Java</code> 的 <code>RMI</code>。</p>
</blockquote>
<h3 id="3-通过BrowserWindow-打开新窗口"><a href="#3-通过BrowserWindow-打开新窗口" class="headerlink" title="3 通过BrowserWindow 打开新窗口"></a>3 通过BrowserWindow 打开新窗口</h3><blockquote>
<p><code>Electron</code> 渲染进程中通过 <strong><code>remote</code> 模块调用主进程中的 <code>BrowserWindow</code></strong> 打开新窗口<br><a href="https://electronjs.org/docs/api/browser-window" target="_blank" rel="noopener">https://electronjs.org/docs/api/browser-window</a></p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 主进程代码</span>

<span class="token keyword">const</span> electron <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment" spellcheck="true">// 控制应用生命周期的模块 </span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>app<span class="token punctuation">}</span> <span class="token operator">=</span> electron<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 创建本地浏览器窗口的模块 </span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>BrowserWindow<span class="token punctuation">}</span> <span class="token operator">=</span> electron<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 指向窗口对象的一个全局引用，如果没有这个引用，那么当该 javascript 对象被垃圾回收 的</span>
<span class="token comment" spellcheck="true">// 时候该窗口将会自动关闭</span>
<span class="token keyword">let</span> win<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 创建一个新的浏览器窗口</span>
    win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token punctuation">:</span> <span class="token number">1104</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">620</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//570+50</span>

    <span class="token comment" spellcheck="true">// 并且装载应用的 index.html 页面</span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`file://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/html/index.html`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 打开开发工具页面</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//当窗口关闭时调用的方法</span>
    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 解除窗口对象的引用，通常而言如果应用支持多个窗口的话，你会在一个数组里 // 存放窗口对象，在窗口关闭的时候应当删除相应的元素。</span>
        win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 当 Electron 完成初始化并且已经创建了浏览器窗口，则该方法将会被调用。</span>
<span class="token comment" spellcheck="true">// 有些 API 只能在该事件发生后才能被使用</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> createWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 当所有的窗口被关闭后退出应用 </span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-all-closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 对于 OS X 系统，应用和相应的菜单栏会一直激活直到用户通过 Cmd + Q 显式退出 </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">!==</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 对于 OS X 系统，当 dock 图标被点击后会重新创建一个 app 窗口，并且不会有其他</span>
    <span class="token comment" spellcheck="true">// 窗口打开</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>win <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 在这个文件后面你可以直接包含你应用特定的由主进程运行的代码。 </span>
<span class="token comment" spellcheck="true">// 也可以把这些代码放在另一个文件中然后在这里导入</span>
<span class="token comment" spellcheck="true">// 渲染进程代码 /src/render/index.js</span>
<span class="token comment" spellcheck="true">// 打开新窗口属性用法有点类似vscode打开新的窗口</span>

<span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> BrowerWindow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>remote<span class="token punctuation">.</span>BrowserWindow<span class="token punctuation">;</span>

btn<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowerWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
        width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> 
        frame<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// false隐藏关闭按钮、菜单选项 true显示</span>
        fullscreen<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 全屏展示</span>
        transparent<span class="token punctuation">:</span> <span class="token boolean">true</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 

    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'file:'</span><span class="token punctuation">,</span>__dirname<span class="token punctuation">,</span><span class="token string">'news.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="../../../static/2020/53.png" alt="img"></p>
<h2 id="五、自定义顶部菜单-右键菜单"><a href="#五、自定义顶部菜单-右键菜单" class="headerlink" title="五、自定义顶部菜单/右键菜单"></a>五、自定义顶部菜单/右键菜单</h2><p><img src="../../../static/2020/54.png" alt="img"></p>
<h3 id="1-主进程中调用Menu模块-自定义软件顶部菜单"><a href="#1-主进程中调用Menu模块-自定义软件顶部菜单" class="headerlink" title="1 主进程中调用Menu模块-自定义软件顶部菜单"></a>1 主进程中调用Menu模块-自定义软件顶部菜单</h3><blockquote>
<p><a href="https://electronjs.org/docs/api/menu-item" target="_blank" rel="noopener">https://electronjs.org/docs/api/menu-item</a><br><code>Electron</code> 中 <code>Menu</code> 模块可以用来创建原生菜单，它可用作应用菜单和 <code>context</code> 菜单<br>这个模块是一个主进程的模块，并且可以通过 <code>remote</code> 模块给渲染进程调用</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// main/menu.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Menu <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 文档 https://electronjs.org/docs/api/menu-item</span>
<span class="token comment" spellcheck="true">// 菜单项目</span>
<span class="token keyword">let</span> menus <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'文件'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'新建文件'</span><span class="token punctuation">,</span>
                accelerator<span class="token punctuation">:</span> <span class="token string">'ctrl+n'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 绑定快捷键</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 绑定事件</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新建文件'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'新建窗口'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新建窗口'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'编辑'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'复制'</span><span class="token punctuation">,</span>
                role<span class="token punctuation">:</span> <span class="token string">'copy'</span> <span class="token comment" spellcheck="true">// 调用内置角色实现对应功能</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'剪切'</span><span class="token punctuation">,</span>
                role<span class="token punctuation">:</span> <span class="token string">'cut'</span>  <span class="token comment" spellcheck="true">// 调用内置角色实现对应功能</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'视图'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'浏览'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'搜索'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">let</span> m <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>menus<span class="token punctuation">)</span>
Menu<span class="token punctuation">.</span><span class="token function">setApplicationMenu</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/menu.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="../../../static/2020/55.png" alt="img"></p>
<blockquote>
<p>我们给菜单绑定事件，在命令行控制台可以看到</p>
</blockquote>
<p><img src="../../../static/2020/56.png" alt="img"></p>
<h3 id="2-渲染进程中调用Menu模块"><a href="#2-渲染进程中调用Menu模块" class="headerlink" title="2 渲染进程中调用Menu模块"></a>2 渲染进程中调用Menu模块</h3><blockquote>
<p>不推荐使用这种方式，建议在主进程中使用</p>
</blockquote>
<p><strong>1. remote</strong></p>
<blockquote>
<p>通过<code>remote</code>调用主进程的方法</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 菜单引入的方式发生变化</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Menu <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>remote

<span class="token comment" spellcheck="true">// 其他代码和上面菜单一样</span>
<span class="token comment" spellcheck="true">// ...</span>
</code></pre>
<p><strong>2. 加入index.html</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/menu.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<h3 id="3-渲染进程中自定义右键菜单"><a href="#3-渲染进程中自定义右键菜单" class="headerlink" title="3 渲染进程中自定义右键菜单"></a>3 渲染进程中自定义右键菜单</h3><p><strong>1. 定义菜单</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// render/menu.js</span>

<span class="token comment" spellcheck="true">// 在渲染进程中通过remote模块调用主进程中的模块</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Menu <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>remote
<span class="token keyword">const</span> <span class="token punctuation">{</span> remote <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 文档 https://electronjs.org/docs/api/menu-item</span>
<span class="token comment" spellcheck="true">// 菜单项目</span>
<span class="token keyword">let</span> menus <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'文件'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'新建文件'</span><span class="token punctuation">,</span>
                accelerator<span class="token punctuation">:</span> <span class="token string">'ctrl+n'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 绑定快捷键</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 绑定事件</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新建文件'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'新建窗口'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新建窗口'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'编辑'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'复制'</span><span class="token punctuation">,</span>
                role<span class="token punctuation">:</span> <span class="token string">'copy'</span> <span class="token comment" spellcheck="true">// 调用内置角色实现对应功能</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'剪切'</span><span class="token punctuation">,</span>
                role<span class="token punctuation">:</span> <span class="token string">'cut'</span>  <span class="token comment" spellcheck="true">// 调用内置角色实现对应功能</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'视图'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'浏览'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'搜索'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">let</span> m <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>menus<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// Menu.setApplicationMenu(m)</span>

<span class="token comment" spellcheck="true">// 绑定右键菜单</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
   e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   m<span class="token punctuation">.</span><span class="token function">popup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    window<span class="token punctuation">:</span> remote<span class="token punctuation">.</span><span class="token function">getCurrentWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/57.png" alt="img"></p>
<p><strong>2. 引入</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/menu.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<h2 id="六、进程通信"><a href="#六、进程通信" class="headerlink" title="六、进程通信"></a>六、进程通信</h2><p><img src="../../../static/2020/58.png" alt="img"></p>
<ul>
<li>渲染进程 <a href="https://electronjs.org/docs/api/ipc-renderer" target="_blank" rel="noopener">https://electronjs.org/docs/api/ipc-renderer</a></li>
<li>主进程 <a href="https://electronjs.org/docs/api/ipc-main" target="_blank" rel="noopener">https://electronjs.org/docs/api/ipc-main</a></li>
</ul>
<h3 id="1-主进程与渲染进程之间的通信"><a href="#1-主进程与渲染进程之间的通信" class="headerlink" title="1 主进程与渲染进程之间的通信"></a>1 主进程与渲染进程之间的通信</h3><blockquote>
<p>有时候我们想在渲染进程中通过一个事件去执行主进程里面的方法。或者在渲染进程中通知 主进程处理事件，主进程处理完成后广播一个事件让渲染进程去处理一些事情。这个时候就 用到了主进程和渲染进程之间的相互通信</p>
</blockquote>
<blockquote>
<p><code>Electron</code> 主进程，和渲染进程的通信主要用到两个模块:<code>ipcMain</code> 和 <code>ipcRenderer</code></p>
</blockquote>
<ul>
<li><code>ipcMain</code>:当在主进程中使用时，它处理从渲染器进程(网页)发送出来的异步和同步信息,当然也有可能从主进程向渲染进程发送消息。</li>
<li><code>ipcRenderer</code>: 使用它提供的一些方法从渲染进程 (<code>web</code> 页面) 发送同步或异步的消息到主进程。 也可以接收主进程回复的消息</li>
</ul>
<h4 id="1-1-渲染进程给主进程发送异步消息"><a href="#1-1-渲染进程给主进程发送异步消息" class="headerlink" title="1.1 渲染进程给主进程发送异步消息"></a>1.1 渲染进程给主进程发送异步消息</h4><blockquote>
<p>间接实现渲染进程执行主进程里面的方法</p>
</blockquote>
<p><strong>1. 引入ipcRender</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"send"</span><span class="token operator">></span>在 渲染进程中执行主进程里的方法（异步）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/ipcRender.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 引入ipcMain</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/ipcMain.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3. 渲染进程发送消息</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/ipcRender.js</span>
<span class="token comment" spellcheck="true">//渲染进程</span>

<span class="token keyword">let</span> send <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#send'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

send<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 传递消息给主进程</span>
    <span class="token comment" spellcheck="true">// 异步</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'sendMsg'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>2. 主进程接收消息</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain.js</span>

<span class="token comment" spellcheck="true">//主进程</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcMain <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 主进程处理渲染进程广播数据</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'sendMsg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data\n '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'event\n '</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/59.png" alt="img"></p>
<h4 id="1-2-渲染进程发送消息，主进程接收消息并反馈"><a href="#1-2-渲染进程发送消息，主进程接收消息并反馈" class="headerlink" title="1.2 渲染进程发送消息，主进程接收消息并反馈"></a>1.2 渲染进程发送消息，主进程接收消息并反馈</h4><blockquote>
<p>渲染进程给主进程发送异步消息，主进程接收到异步消息以后通知渲染进程</p>
</blockquote>
<p><strong>1. 引入ipcRender</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"sendFeedback"</span><span class="token operator">></span>在 渲染进程中执行主进程里的方法，并反馈给主进程（异步）<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/ipcRender.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 引入ipcMain</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/ipcMain.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3. 渲染进程发送消息</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/ipcRender.js</span>

<span class="token comment" spellcheck="true">//渲染进程</span>
<span class="token keyword">let</span> sendFeedback <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sendFeedback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 向主进程发送消息</span>
sendFeedback<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 触发主进程里面的方法</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'sendFeedback'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>4. 主进程收到消息处理并广播反馈通知渲染进程</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain.js</span>

<span class="token comment" spellcheck="true">//主进程</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> ipcMain <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">// 主进程处理渲染进程广播数据，并反馈给渲染进程</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'sendFeedback'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// console.log('data\n ', data)</span>
    <span class="token comment" spellcheck="true">// console.log('event\n ', event)</span>

    <span class="token comment" spellcheck="true">// 主进程给渲染进程广播数据</span>
    event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'sendFeedbackToRender'</span><span class="token punctuation">,</span> <span class="token string">'来自主进程的反馈'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>5. 渲染进程处理主进程广播的数据</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/ipcRender.js</span>
<span class="token comment" spellcheck="true">// 向主进程发送消息后，接收主进程广播的事件</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'sendFeedbackToRender'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'event\n '</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data\n '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/60.png" alt="img"></p>
<h4 id="1-3-渲染进程给主进程发送同步消息"><a href="#1-3-渲染进程给主进程发送同步消息" class="headerlink" title="1.3 渲染进程给主进程发送同步消息"></a>1.3 渲染进程给主进程发送同步消息</h4><p><strong>1. 引入ipcRender</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
 <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"sendSync"</span><span class="token operator">></span>渲染进程和主进程同步通信<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/ipcRender.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 引入ipcMain</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/ipcMain.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3. 渲染进程给主进程同步通信</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/ipcMain.js</span>
<span class="token keyword">let</span> sendSync <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sendSync'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 渲染进程和主进程同步通信</span>
sendSync<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 同步广播数据</span>
   <span class="token keyword">let</span> msg <span class="token operator">=</span>  ipcRenderer<span class="token punctuation">.</span><span class="token function">sendSync</span><span class="token punctuation">(</span><span class="token string">'sendsync'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

   <span class="token comment" spellcheck="true">// 同步返回主进程反馈的数据</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'msg\n '</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>4. 主进程接收数据处理</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain.js</span>

<span class="token comment" spellcheck="true">// 渲染进程和主进程同步通信 接收同步广播</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'sendsync'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// console.log('data\n ', data)</span>
    <span class="token comment" spellcheck="true">// console.log('event\n ', event)</span>
    <span class="token comment" spellcheck="true">// 主进程给渲染进程广播数据</span>
    event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span><span class="token string">'渲染进程和主进程同步通信 接收同步广播，来自主进程的反馈.'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/61.png" alt="img"></p>
<h4 id="1-4-渲染进程广播通知主进程打开窗口"><a href="#1-4-渲染进程广播通知主进程打开窗口" class="headerlink" title="1.4 渲染进程广播通知主进程打开窗口"></a>1.4 渲染进程广播通知主进程打开窗口</h4><blockquote>
<p>一般都是在渲染进程中执行广播操作，去通知主进程完成任务</p>
</blockquote>
<p><strong>1. 引入openWindow</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
 <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"sendSync"</span><span class="token operator">></span>渲染进程和主进程同步通信<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/openWindow.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 引入ipcMain2</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/ipcMain2.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3. 渲染进程通知主进程打开窗口</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/openWindow.js</span>

<span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">let</span> openWindow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#openWindow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 渲染进程和渲染进程直接的通信========</span>
openWindow<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 通过广播的形式 通知主进程执行操作</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>4. 主进程收到通知执行操作</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain2.js</span>

<span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> ipcMain<span class="token punctuation">,</span>BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> win<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 接收到广播</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 调用window打开新窗口</span>
    win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'file:'</span><span class="token punctuation">,</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../news.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/62.png" alt="img"></p>
<h3 id="2-渲染进程与渲染进程之间的通信"><a href="#2-渲染进程与渲染进程之间的通信" class="headerlink" title="2 渲染进程与渲染进程之间的通信"></a>2 渲染进程与渲染进程之间的通信</h3><blockquote>
<p>也就是两个窗口直接的通信</p>
</blockquote>
<h4 id="2-1-localstorage传值"><a href="#2-1-localstorage传值" class="headerlink" title="2.1 localstorage传值"></a>2.1 localstorage传值</h4><blockquote>
<p><code>Electron</code> 渲染进程通过 <code>localstorage</code> 给另一个渲染进程传值</p>
</blockquote>
<p><strong>1. 引入openWindow</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
 <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"sendSync"</span><span class="token operator">></span>渲染进程和主进程同步通信<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/openWindow.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 引入ipcMain2</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/ipcMain2.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3. 渲染进程通知主进程打开窗口</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/openWindow.js</span>

<span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">let</span> openWindow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#openWindow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 渲染进程和渲染进程直接的通信========</span>
openWindow<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 通过广播的形式 通知主进程执行操作</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// ======= localstorage传值 =====</span>
     localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'poetries'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>4. 新建news页面</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>news<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
  <span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
  <span class="token operator">&lt;</span>body<span class="token operator">></span>
    news page
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/news.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>
<span class="token comment" spellcheck="true">// src/render/news.js</span>

<span class="token keyword">let</span> username <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
</code></pre>
<p><strong>5. 主进程收到通知执行操作</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain2.js</span>

<span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> ipcMain<span class="token punctuation">,</span>BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> win<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 接收到广播</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 调用window打开新窗口</span>
    win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'file:'</span><span class="token punctuation">,</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../news.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="2-2-BrowserWindow和webContents方式实现"><a href="#2-2-BrowserWindow和webContents方式实现" class="headerlink" title="2.2 BrowserWindow和webContents方式实现"></a>2.2 BrowserWindow和webContents方式实现</h4><blockquote>
<p>通过 <code>BrowserWindow</code> 和 <code>webContents</code> 模块实现渲染进程和渲染进程的通信</p>
</blockquote>
<blockquote>
<p><code>webContents</code> 是一个事件发出者.它负责渲染并控制网页，也是 <code>BrowserWindow</code> 对象的属性</p>
</blockquote>
<p><strong>需要了解的几个知识点</strong></p>
<ol>
<li>获取当前窗口的 <code>id</code></li>
</ol>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> winId <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<ol>
<li>监听当前窗口加载完成的事件</li>
</ol>
<pre class=" language-js"><code class="language-js">win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ol>
<li>同一窗口之间广播数据</li>
</ol>
<pre class=" language-js"><code class="language-js">win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span>winId<span class="token punctuation">,</span><span class="token string">'我是 index.html 的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ol>
<li>通过 <code>id</code> 查找窗口</li>
</ol>
<pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> win <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">fromId</span><span class="token punctuation">(</span>winId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>下面是具体演示</p>
</blockquote>
<p><strong>1. 引入openWindow</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
 <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"sendSync"</span><span class="token operator">></span>渲染进程和主进程同步通信<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/openWindow.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 引入ipcMain2</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/ipcMain2.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3. 渲染进程通知主进程打开窗口</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/openWindow.js</span>

<span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">let</span> openWindow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#openWindow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 渲染进程和渲染进程直接的通信========</span>
openWindow<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 通过广播的形式 通知主进程执行操作</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>4. 主进程收到通知执行操作</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain2.js</span>

<span class="token keyword">let</span> <span class="token punctuation">{</span> ipcMain<span class="token punctuation">,</span>BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> win<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 接收到广播</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 调用window打开新窗口</span>
    win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'file:'</span><span class="token punctuation">,</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../news.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 新开窗口调试模式</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 把渲染进程传递过来的数据再次传递给渲染进程news</span>
    <span class="token comment" spellcheck="true">// 等待窗口加载完</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>
        win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'toNews'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>


    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>5. news接收主进程传递的数据</strong></p>
<blockquote>
<p>数据经过渲染进程-&gt;主进程-&gt;<code>news</code>渲染进程</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>news页面<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
  <span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
  <span class="token operator">&lt;</span>body<span class="token operator">></span>
    news page
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/news.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>
<span class="token comment" spellcheck="true">// src/render/news.js</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// let username = localStorage.getItem('username')</span>
<span class="token comment" spellcheck="true">// console.log(username)</span>

<span class="token comment" spellcheck="true">// 监听主进程传递过来的数据 </span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'toNews'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/63.png" alt="img"></p>
<p><img src="../../../static/2020/64.png" alt="img"></p>
<blockquote>
<p>那么，这里有一个问题，<code>news</code>进程接收到了广播后如何给出反馈呢？</p>
</blockquote>
<p><img src="../../../static/2020/65.png" alt="img"></p>
<p><strong>1. 在主进程中获取窗口ID传递</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/ipcMain2.js</span>


<span class="token keyword">let</span> <span class="token punctuation">{</span> ipcMain<span class="token punctuation">,</span>BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> win<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 接收到广播</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// 获取当前窗口ID 放在第一行保险  因为后面也打开了新窗口使得获取的ID有问题</span>
    <span class="token keyword">let</span> winId <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id

    <span class="token comment" spellcheck="true">// 调用window打开新窗口</span>
    win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'file:'</span><span class="token punctuation">,</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../news.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 新开窗口调试模式</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>



    <span class="token comment" spellcheck="true">// 把渲染进程传递过来的数据再次传递给渲染进程news</span>
    <span class="token comment" spellcheck="true">// 等待窗口加载完</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>
        win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'toNews'</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">,</span> winId<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>


    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>2. 在news进程中广播数据</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/news.js</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 注意这里 在渲染进程中需要从remote中获取BrowserWindow</span>
<span class="token keyword">const</span> BrowerWindow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>remote<span class="token punctuation">.</span>BrowserWindow<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// let username = localStorage.getItem('username')</span>
<span class="token comment" spellcheck="true">// console.log(username)</span>

<span class="token comment" spellcheck="true">// 监听主进程传递过来的数据 </span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'toNews'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> userInfo<span class="token punctuation">,</span> winId<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// windID 第一个窗口ID</span>
    <span class="token comment" spellcheck="true">// 获取对应ID的窗口</span>
    <span class="token keyword">let</span> firstWin <span class="token operator">=</span> BrowerWindow<span class="token punctuation">.</span><span class="token function">fromId</span><span class="token punctuation">(</span>winId<span class="token punctuation">)</span>
    firstWin<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'toIndex'</span><span class="token punctuation">,</span> <span class="token string">'来自news进程反馈的信息'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>3. 在另一个渲染进程中处理广播</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">let</span> openWindow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#openWindow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 渲染进程和渲染进程直接的通信========</span>
openWindow<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 传递消息给主进程</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'openwindow'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'poetries'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 传递给打开的窗口 渲染进程和渲染进程直接的通信</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'poetries'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 接收news渲染进程传递回来的消息</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'toIndex'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'==='</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/66.png" alt="img"></p>
<h2 id="七、Electron-Shell-模块"><a href="#七、Electron-Shell-模块" class="headerlink" title="七、Electron Shell 模块"></a>七、Electron Shell 模块</h2><p><img src="../../../static/2020/67.png" alt="img"></p>
<h3 id="1-Shell-模块使用"><a href="#1-Shell-模块使用" class="headerlink" title="1 Shell 模块使用"></a>1 Shell 模块使用</h3><blockquote>
<p>文档 <a href="https://electronjs.org/docs/api/shell" target="_blank" rel="noopener">https://electronjs.org/docs/api/shell</a></p>
</blockquote>
<blockquote>
<p><code>Electron Shell</code> 模块在用户默认浏览器 中打开 <code>URL</code> 以及 <code>Electron DOM webview</code> 标签。<code>Shell</code>既属于主进程模块又是渲染进程模块</p>
</blockquote>
<blockquote>
<p><code>shell</code> 模块提供了集成其他桌面客户端的关联功能</p>
</blockquote>
<p><strong>1. 引入</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"shellDom"</span><span class="token operator">></span>通过shell打开外部链接<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/shell.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. shell.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/render/shell.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> shell <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> shellDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#shellDom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

shellDom<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span><span class="token string">'https://github.com/poetries'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="2-Electron-DOM-标签"><a href="#2-Electron-DOM-标签" class="headerlink" title="2 Electron DOM  标签"></a>2 <code>Electron DOM</code> <code></code> 标签</h3><blockquote>
<p><code>Webview</code> 与 <code>iframe</code> 有点相似，但是与 <code>iframe</code> 不同, <code>webview</code> 和你的应用运行的是不同的进程。它不拥有渲染进程的权限，并且应用和嵌入内容之间的交互全部都是异步的。因为这能 保证应用的安全性不受嵌入内容的影响。</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html中引入<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>webview id<span class="token operator">=</span><span class="token string">"webview"</span> src<span class="token operator">=</span><span class="token string">"http://blog.poetries.top"</span> style<span class="token operator">=</span><span class="token string">"position:fixed; width:100%; height:100%"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>webview<span class="token operator">></span>
</code></pre>
<h3 id="3-shell模块结合Menu模块使用案例"><a href="#3-shell模块结合Menu模块使用案例" class="headerlink" title="3 shell模块结合Menu模块使用案例"></a>3 <code>shell</code>模块<code></code>结合<code>Menu</code>模块使用案例</h3><p><strong>1. 新建src/render/webview.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">var</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myWebview <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#myWebview'</span><span class="token punctuation">)</span>

ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'openwebview'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    myWebview<span class="token punctuation">.</span>src <span class="token operator">=</span> url
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>2. 引入src/index.html</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>webview id<span class="token operator">=</span><span class="token string">"myWebview"</span> src<span class="token operator">=</span><span class="token string">"http://blog.poetries.top"</span> style<span class="token operator">=</span><span class="token string">"position:fixed; width:100%; height:100%"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>webview<span class="token operator">></span>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/webview.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>3. 新建src/main/menu.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* eslint-disable */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> shell<span class="token punctuation">,</span> Menu<span class="token punctuation">,</span> BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 当前窗口渲染网页</span>
<span class="token keyword">function</span> <span class="token function">openWebView</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 获取当前窗口Id</span>
    <span class="token keyword">let</span> win <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 广播通知渲染进程打开webview</span>
    win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'openwebview'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 在窗口外打开网页</span>
<span class="token keyword">function</span> <span class="token function">openWeb</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'帮助'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'关于我们'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">openWeb</span><span class="token punctuation">(</span><span class="token string">'http://blog.poetries.top'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'separator'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'联系我们'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">openWeb</span><span class="token punctuation">(</span><span class="token string">'https://github.com/poetries'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'加载网页'</span><span class="token punctuation">,</span>
        submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'博客'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">openWebView</span><span class="token punctuation">(</span><span class="token string">'http://blog.poetries.top'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'separator'</span> <span class="token comment" spellcheck="true">// 分隔符</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'GitHub'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">openWebView</span><span class="token punctuation">(</span><span class="token string">'https://github.com/poetries'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'separator'</span> <span class="token comment" spellcheck="true">// 分隔符</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token string">'简书'</span><span class="token punctuation">,</span>
                click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">openWebView</span><span class="token punctuation">(</span><span class="token string">'https://www.jianshu.com/users/94077fcddfc0/timeline'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token string">'视频网站'</span><span class="token punctuation">,</span>
    submenu<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'优酷'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">openWebView</span><span class="token punctuation">(</span><span class="token string">'https://www.youku.com'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'separator'</span> <span class="token comment" spellcheck="true">// 分隔符</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'爱奇艺'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">openWebView</span><span class="token punctuation">(</span><span class="token string">'https://www.iqiyi.com/'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'separator'</span> <span class="token comment" spellcheck="true">// 分隔符</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'腾讯视频'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">openWebView</span><span class="token punctuation">(</span><span class="token string">'https://v.qq.com/'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">let</span> m <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
Menu<span class="token punctuation">.</span><span class="token function">setApplicationMenu</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</code></pre>
<p><strong>4. 引入menu</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 在主进程src/index.js中引入</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 创建菜单  </span>
  <span class="token comment" spellcheck="true">// 引入菜单模块</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/menu.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="../../../static/2020/68.png" alt="img"></p>
<h2 id="八、Electron-dialog-弹出框"><a href="#八、Electron-dialog-弹出框" class="headerlink" title="八、Electron dialog 弹出框"></a>八、Electron dialog 弹出框</h2><p><img src="../../../static/2020/69.png" alt="img"></p>
<blockquote>
<p>文档 <a href="https://electronjs.org/docs/api/dialog" target="_blank" rel="noopener">https://electronjs.org/docs/api/dialog</a><br><code>dialog</code>属于主进程中的模块<br><code>dialog</code> 模块提供了 <code>api</code> 来展示原生的系统对话框，例如打开文件框，<code>alert</code> 框， 所以 <code>web</code> 应用可以给用户带来跟系统应用相同的体验</p>
</blockquote>
<p><strong>1. 在src/index.html中引入</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"showError"</span><span class="token operator">></span>showError<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"showMsg"</span><span class="token operator">></span>showMsg<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"showOpenDialog"</span><span class="token operator">></span>showOpenDialog<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"saveDialog"</span><span class="token operator">></span>saveDialog<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/dialog.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 新建render/dialog.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// render/dialog.js</span>

<span class="token keyword">let</span> showError <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#showError'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> showMsg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#showMsg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> showOpenDialog <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#showOpenDialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> saveDialog <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#saveDialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span>remote<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

showError<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showErrorBox</span><span class="token punctuation">(</span><span class="token string">'警告'</span><span class="token punctuation">,</span> <span class="token string">'操作有误'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
showMsg<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showMessageBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token string">'提示信息'</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> <span class="token string">'内容'</span><span class="token punctuation">,</span>
        buttons<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'确定'</span><span class="token punctuation">,</span> <span class="token string">'取消'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
showOpenDialog<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showOpenDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 打开文件夹</span>
        properties<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'openDirectory'</span><span class="token punctuation">,</span> <span class="token string">'openFile'</span><span class="token punctuation">]</span>

        <span class="token comment" spellcheck="true">// 打开文件</span>
        <span class="token comment" spellcheck="true">// properties: ['openFile']</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
saveDialog<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showSaveDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">'Save File'</span><span class="token punctuation">,</span>
        defaultPath<span class="token punctuation">:</span> <span class="token string">'/Users/poetry/Downloads/'</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// filters 指定一个文件类型数组，用于规定用户可见或可选的特定类型范围</span>
        filters<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Images'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Movies'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'mkv'</span><span class="token punctuation">,</span> <span class="token string">'avi'</span><span class="token punctuation">,</span> <span class="token string">'mp4'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Custom File Type'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'as'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'All Files'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 不是真的保存 ，具体还需nodejs处理</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>showError</strong></p>
<pre class=" language-js"><code class="language-js">remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showErrorBox</span><span class="token punctuation">(</span><span class="token string">'警告'</span><span class="token punctuation">,</span> <span class="token string">'操作有误'</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/70.png" alt="img"></p>
<p><strong>showMessageBox</strong></p>
<pre class=" language-js"><code class="language-js">remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showMessageBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
    title<span class="token punctuation">:</span> <span class="token string">'提示信息'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'内容'</span><span class="token punctuation">,</span>
    buttons<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'确定'</span><span class="token punctuation">,</span> <span class="token string">'取消'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/71.png" alt="img"></p>
<p><strong>showOpenDialog</strong></p>
<pre class=" language-js"><code class="language-js">remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showOpenDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 打开文件夹</span>
    properties<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'openDirectory'</span><span class="token punctuation">,</span> <span class="token string">'openFile'</span><span class="token punctuation">]</span>

    <span class="token comment" spellcheck="true">// 打开文件</span>
    <span class="token comment" spellcheck="true">// properties: ['openFile']</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/72.png" alt="img"></p>
<p><strong>showSaveDialog</strong></p>
<pre class=" language-js"><code class="language-js">remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showSaveDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'Save File'</span><span class="token punctuation">,</span>
    defaultPath<span class="token punctuation">:</span> <span class="token string">'/Users/poetry/Downloads/'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// filters 指定一个文件类型数组，用于规定用户可见或可选的特定类型范围</span>
    filters<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Images'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Movies'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'mkv'</span><span class="token punctuation">,</span> <span class="token string">'avi'</span><span class="token punctuation">,</span> <span class="token string">'mp4'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Custom File Type'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'as'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'All Files'</span><span class="token punctuation">,</span> extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 不是真的保存 ，具体还需nodejs处理</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="../../../static/2020/73.png" alt="img"></p>
<h2 id="九、实现一个简易记事本代码编辑器"><a href="#九、实现一个简易记事本代码编辑器" class="headerlink" title="九、实现一个简易记事本代码编辑器"></a>九、实现一个简易记事本代码编辑器</h2><blockquote>
<p>代码 <a href="https://github.com/poetries/electron-demo/tree/master/notepad" target="_blank" rel="noopener">https://github.com/poetries/electron-demo/tree/master/notepad</a></p>
</blockquote>
<h2 id="十、系统托盘、托盘右键菜单、托盘图标闪烁"><a href="#十、系统托盘、托盘右键菜单、托盘图标闪烁" class="headerlink" title="十、系统托盘、托盘右键菜单、托盘图标闪烁"></a>十、系统托盘、托盘右键菜单、托盘图标闪烁</h2><p><img src="../../../static/2020/74.png" alt="img"></p>
<blockquote>
<p>文档 <a href="https://electronjs.org/docs/api/tray" target="_blank" rel="noopener">https://electronjs.org/docs/api/tray</a><br>系统托盘，托盘右键菜单、托盘图标闪烁 点击右上角关闭按钮隐藏到托盘(仿杀毒软件)</p>
</blockquote>
<p><strong>1. 引入文件</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/index.js</span>
<span class="token keyword">const</span> createWindow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/tray.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>2. Electron 创建任务栏图标以及任务栏图标右键菜单</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/tray.js</span>
<span class="token keyword">var</span> <span class="token punctuation">{</span>
    Menu<span class="token punctuation">,</span> Tray<span class="token punctuation">,</span> app<span class="token punctuation">,</span> BrowserWindow
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> appIcon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../static/lover.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> menu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'设置'</span><span class="token punctuation">,</span>
        click<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//打开相应页面 </span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'帮助'</span><span class="token punctuation">,</span>
        click<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'关于'</span><span class="token punctuation">,</span>
        click<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'退出'</span><span class="token punctuation">,</span>
        click<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token comment" spellcheck="true">// BrowserWindow.getFocusedWindow().webContents().send('close-main-window');</span>
            app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 鼠标放上去提示信息</span>
appIcon<span class="token punctuation">.</span><span class="token function">setToolTip</span><span class="token punctuation">(</span><span class="token string">'hello poetries'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
appIcon<span class="token punctuation">.</span><span class="token function">setContextMenu</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="../../../static/2020/75.png" alt="img"></p>
<p><strong>3. 监听任务栏图标的单击、双击事件</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 实现点击关闭按钮，让应用保存在托盘里面，双击托盘打开</span>
<span class="token keyword">let</span> win <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    win<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

iconTray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'double-click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    win<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>4. Electron 点击右上角关闭按钮隐藏任务栏图标</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> win <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>win<span class="token punctuation">.</span><span class="token function">isFocused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>win<span class="token punctuation">.</span><span class="token function">isFocused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        win <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*阻止应用退出*/</span>
        win<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*隐藏当前窗口*/</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>5. Electron 实现任务栏闪烁图标</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> appIcon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../static/lover.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        appIcon<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../static/empty.ico'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        appIcon<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../static/lover.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="十一、消息通知、监听网络变化"><a href="#十一、消息通知、监听网络变化" class="headerlink" title="十一、消息通知、监听网络变化"></a>十一、消息通知、监听网络变化</h2><h3 id="1-消息通知"><a href="#1-消息通知" class="headerlink" title="1 消息通知"></a>1 消息通知</h3><p><strong>1. Electron 实现消息通知</strong></p>
<blockquote>
<p><code>Electron</code> 里面的消息通知是基于 <code>h5</code> 的通知 <code>api</code> 实现的<br>文档 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/notification" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/notification</a></p>
</blockquote>
<p><strong>1. 新建notification.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// h5api实现通知</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'electron 通知API'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> <span class="token string">'hello poetries'</span><span class="token punctuation">,</span>
    icon<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'../static/img/favicon2.ico'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 通知图标</span>
<span class="token punctuation">}</span>


document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#showNotification'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> myNotification  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>Notification</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>title<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 消息可点击</span>
    myNotification<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click notification'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>2. 引入</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>

<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"showNotification"</span><span class="token operator">></span>弹出消息通知<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/notification.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><code>mac</code>上的消息通知</p>
<p><img src="../../../static/2020/76.png" alt="img"></p>
<h3 id="2-监听网络变化"><a href="#2-监听网络变化" class="headerlink" title="2 监听网络变化"></a>2 监听网络变化</h3><p><strong>1. 基本使用</strong></p>
<pre class=" language-js"><code class="language-js"> <span class="token comment" spellcheck="true">// 监听网络变化</span>
<span class="token comment" spellcheck="true">// 端开网络 再次连接测试</span>
 window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

 window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>2. 监听网络变化实现消息通知</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 端开网络 再次连接测试</span>
<span class="token comment" spellcheck="true">// 监听网络变化实现消息通知</span>
 window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 断开网络触发事件</span>
    <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">'QQ邮箱'</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token string">'网络异常，请检查你的网络'</span><span class="token punctuation">,</span>
        icon<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'../static/img/favicon2.ico'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 通知图标</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> myNotification  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>Notification</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>title<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    myNotification<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click notification'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img src="../../../static/2020/77.png" alt="img"></p>
<h2 id="十二、注册全局快捷键-剪切板事件-nativeImage-模块"><a href="#十二、注册全局快捷键-剪切板事件-nativeImage-模块" class="headerlink" title="十二、注册全局快捷键/剪切板事件/nativeImage 模块"></a>十二、注册全局快捷键/剪切板事件/nativeImage 模块</h2><blockquote>
<p><code>Electron</code> 注册全局快捷键 (<code>globalShortcut</code>) 以及 <code>clipboard</code> 剪 切板事件以及 <code>nativeImage</code> 模块(实现类似播放器点击机器码自动复制功 能)</p>
</blockquote>
<h3 id="1-注册全局快捷键"><a href="#1-注册全局快捷键" class="headerlink" title="1 注册全局快捷键"></a>1 注册全局快捷键</h3><p><img src="../../../static/2020/78.png" alt="img"></p>
<ul>
<li><a href="https://electronjs.org/docs/tutorial/keyboard-shortcuts" target="_blank" rel="noopener">keyboard-shortcuts文档</a></li>
<li><a href="https://electronjs.org/docs/api/app" target="_blank" rel="noopener">app模块参考文档</a></li>
</ul>
<p><strong>1. 新建src/main/shortCut.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>globalShortcut<span class="token punctuation">,</span> app<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 注册全局快捷键</span>
    globalShortcut<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'command+e'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 检测快捷键是否注册成功 true是注册成功</span>
    <span class="token keyword">let</span> isRegister <span class="token operator">=</span> globalShortcut<span class="token punctuation">.</span><span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token string">'command+e'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>isRegister<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 退出的时候取消全局快捷键</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'will-quit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    globalShortcut<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token string">'command+e'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>2. 引入src/index.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 注意在外部引入即可 不用放到app中</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/shortCut.js'</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="2-剪切板clipboard、nativeImage-模块"><a href="#2-剪切板clipboard、nativeImage-模块" class="headerlink" title="2 剪切板clipboard、nativeImage 模块"></a>2 剪切板clipboard、nativeImage 模块</h3><p><img src="../../../static/2020/79.png" alt="img"></p>
<ul>
<li><a href="https://electronjs.org/docs/api/clipboard" target="_blank" rel="noopener">剪切板clipboard文档</a></li>
<li><a href="https://electronjs.org/docs/api/native-image" target="_blank" rel="noopener">nativeImage模块</a></li>
</ul>
<p><strong>1. html</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>h2<span class="token operator">></span>双击下面信息复制<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
  <span class="token operator">&lt;</span>p id<span class="token operator">=</span><span class="token string">'msg'</span><span class="token operator">></span><span class="token number">123456789</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
  <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"plat"</span><span class="token operator">></span>粘贴<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"text"</span> type<span class="token operator">=</span><span class="token string">"text"</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">.</span>
<span class="token operator">&lt;</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>h2<span class="token operator">></span>复制图片到界面<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
  <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"copyImg"</span><span class="token operator">></span>复制图片<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"render/clipboard.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p><strong>2. 新建src/render/clipboard.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// clipboard可以在主进程或渲染进程使用</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> clipboard<span class="token punctuation">,</span> nativeImage <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//复制</span>
<span class="token comment" spellcheck="true">// 运行ctrl+v可看到复制的内容</span>
<span class="token comment" spellcheck="true">// clipboard.writeText('poetries')</span>

<span class="token comment" spellcheck="true">// clipboard.readText() //获取复制的内容 粘贴</span>

<span class="token comment" spellcheck="true">// 双击复制消息</span>
<span class="token keyword">let</span> msg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#msg'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> plat <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#plat'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> text <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#text'</span><span class="token punctuation">)</span>

msg<span class="token punctuation">.</span>ondblclick  <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
plat<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">.</span>value <span class="token operator">=</span> clipboard<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 复制图片显示到界面</span>
<span class="token keyword">let</span> copyImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#copyImg'</span><span class="token punctuation">)</span>
copyImg<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 结合nativeImage模块</span>
    <span class="token keyword">let</span> image <span class="token operator">=</span> nativeImage<span class="token punctuation">.</span><span class="token function">createFromPath</span><span class="token punctuation">(</span><span class="token string">'../static/img/lover.png'</span><span class="token punctuation">)</span> 

    <span class="token comment" spellcheck="true">// 复制图片</span>
    clipboard<span class="token punctuation">.</span><span class="token function">writeImage</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 粘贴图片</span>
    <span class="token keyword">let</span> imgSrc <span class="token operator">=</span> clipboard<span class="token punctuation">.</span><span class="token function">readImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// base64图片</span>

    <span class="token comment" spellcheck="true">// 显示到页面上</span>
    <span class="token keyword">let</span> imgDom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    imgDom<span class="token punctuation">.</span>src <span class="token operator">=</span> imgSrc 
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgDom<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="十三、结合electron-vue"><a href="#十三、结合electron-vue" class="headerlink" title="十三、结合electron-vue"></a>十三、结合electron-vue</h2><h3 id="1-electron-vue-的使用"><a href="#1-electron-vue-的使用" class="headerlink" title="1 electron-vue 的使用"></a>1 electron-vue 的使用</h3><p><strong>1. electron-vue 的一些资源</strong></p>
<blockquote>
<p><a href="https://github.com/SimulatedGREG/electron-vue" target="_blank" rel="noopener">https://github.com/SimulatedGREG/electron-vue</a></p>
</blockquote>
<p><code>Electron-vue</code> 文档 <a href="https://simulatedgreg.gitbooks.io/electron-vue/content/cn" target="_blank" rel="noopener">https://simulatedgreg.gitbooks.io/electron-vue/content/cn</a></p>
<p><strong>2. electron-vue 环境搭建、创建项目</strong></p>
<pre class=" language-js"><code class="language-js">npm install <span class="token operator">-</span>g vue<span class="token operator">-</span>cli

vue init simulatedgreg<span class="token operator">/</span>electron<span class="token operator">-</span>vue my<span class="token operator">-</span>project

cd my<span class="token operator">-</span>project

yarn # or npm install

yarn run dev # or npm run dev
</code></pre>
<p><strong>3. electron-vue 目录结构分析</strong></p>
<p><img src="../../../static/2020/80.png" alt="img"></p>
<h3 id="2-electron-vue-中使用-sass-ElementUi"><a href="#2-electron-vue-中使用-sass-ElementUi" class="headerlink" title="2 electron-vue 中使用 sass/ElementUi"></a>2 electron-vue 中使用 sass/ElementUi</h3><p><strong>1. electron-vue UI 框架 ElementUi 的使用</strong></p>
<blockquote>
<p><a href="http://element-cn.eleme.io/#/zh-CN" target="_blank" rel="noopener">http://element-cn.eleme.io/#/zh-CN</a></p>
</blockquote>
<p><strong>2. electron-vue 中使用 sass</strong></p>
<ul>
<li><a href="https://simulatedgreg.gitbooks.io/electron-vue/content/cn/using_pre-processors.html" target="_blank" rel="noopener">electron-vue 中使用 sass</a></li>
</ul>
<pre class=" language-js"><code class="language-js"># 安装 sass<span class="token operator">-</span>loader<span class="token punctuation">:</span>

npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev sass<span class="token operator">-</span>loader node<span class="token operator">-</span>sass
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>vue 文件中修改 style 为如下代码<span class="token punctuation">:</span><span class="token operator">--</span><span class="token operator">></span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"scss"</span><span class="token operator">></span> 
    body <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/* SCSS */</span> 
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span>
</code></pre>
<h3 id="3-electron-vue-中隐藏顶部菜单隐藏"><a href="#3-electron-vue-中隐藏顶部菜单隐藏" class="headerlink" title="3 electron-vue 中隐藏顶部菜单隐藏"></a>3 electron-vue 中隐藏顶部菜单隐藏</h3><blockquote>
<p>electron-vue 中隐藏顶部菜单隐藏顶部最大化、最小化、关闭按钮 自定最大化、最小化 、关闭按钮</p>
</blockquote>
<p><strong>1. electron-vue 中隐藏顶部菜单</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/index.js</span>
mainWindow<span class="token punctuation">.</span><span class="token function">setMenu</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>2. electron-vue 中隐藏关闭 最大化 最小化按钮</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// src/main/index.js</span>
mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    height<span class="token punctuation">:</span> <span class="token number">620</span><span class="token punctuation">,</span>
    useContentSize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    width<span class="token punctuation">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
    frame<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment" spellcheck="true">/*去掉顶部导航 去掉关闭按钮 最大化最小化按钮*/</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>3 .electron-vue 自定义关闭/最大化最小化按钮</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 注意在mac下不需要监听窗口最大最小化、以为系统默认支持，这个只是针对windows平台</span>

ipc<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-min'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">minimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//登录窗口最大化 </span>
ipc<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-max'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mainWindow<span class="token punctuation">.</span><span class="token function">isMaximized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mainWindow<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mainWindow<span class="token punctuation">.</span><span class="token function">maximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 

ipc<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-close'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>4. electron-vue 自定义导航可拖拽</strong></p>
<ul>
<li>可拖拽的 <code>css</code>: <code>-webkit-app-region: drag;</code></li>
<li>不可拖拽的 <code>css</code>: <code>-webkit-app-region: no-drag;</code></li>
</ul>
<h3 id="4-使用electron-vue开发舆情监控系统"><a href="#4-使用electron-vue开发舆情监控系统" class="headerlink" title="4 使用electron-vue开发舆情监控系统"></a>4 使用electron-vue开发舆情监控系统</h3><h4 id="4-1-配置开发环境"><a href="#4-1-配置开发环境" class="headerlink" title="4.1 配置开发环境"></a>4.1 配置开发环境</h4><p><strong>1. 项目搭建</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g vue-cli

vue init simulatedgreg/electron-vue my-project

<span class="token function">cd</span> my-project

yarn <span class="token comment" spellcheck="true"># or npm install</span>

yarn run dev <span class="token comment" spellcheck="true"># or npm run dev</span>
</code></pre>
<p><strong>2. 安装一些依赖</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装 sass-loader:</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev sass-loader node-sass

<span class="token comment" spellcheck="true"># 安装elementUI、js-md5</span>
<span class="token function">npm</span> i element-ui  js-md5 -S
</code></pre>
<ul>
<li>在<code>.electron-vue/webpack.renderer.config.js</code>中配置<code>sass-loader</code>就可以编写<code></code>sass`了</li>
</ul>
<pre class=" language-css"><code class="language-css"><span class="token selector">&lt;!--vue 文件中修改 style 为如下代码<span class="token pseudo-class">:--</span>>

&lt;style lang="scss"> 
    body </span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/* SCSS */</span> 
    <span class="token punctuation">}</span>
&lt;/style>
</code></pre>
<h4 id="4-2-主进程配置"><a href="#4-2-主进程配置" class="headerlink" title="4.2 主进程配置"></a>4.2 主进程配置</h4><p><strong>1. <code>src/main/index.js</code></strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> createWindow <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 去掉顶部菜单</span>
  mainWindow<span class="token punctuation">.</span><span class="token function">setMenu</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">// 菜单项</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./model/menu.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 系统托盘相关</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./model/tray.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>2. <code>src/main/menu.js</code>菜单配置</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Menu<span class="token punctuation">,</span>ipcMain<span class="token punctuation">,</span>BrowserWindow<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//右键菜单</span>
<span class="token keyword">const</span> contextMenuTemplate<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'复制'</span><span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token string">'copy'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'黏贴'</span><span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token string">'paste'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        
    <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'separator'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//分隔线</span>
    <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token string">'其他功能'</span><span class="token punctuation">,</span>     
        click<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> contextMenu<span class="token operator">=</span>Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>contextMenuTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>


ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    contextMenu<span class="token punctuation">.</span><span class="token function">popup</span><span class="token punctuation">(</span>BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>3. <code>src/main/tray.js</code>系统托盘配置</strong></p>
<blockquote>
<p>托盘点击监听事件只有在<code>windows</code>下才生效，<code>mac</code>系统默认支持</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>app<span class="token punctuation">,</span>Menu<span class="token punctuation">,</span>BrowserWindow<span class="token punctuation">,</span>Tray<span class="token punctuation">,</span> shell<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//创建系统托盘</span>
    <span class="token keyword">const</span> tray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__static<span class="token punctuation">,</span> <span class="token string">'favicon.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//给托盘增加右键菜单</span>
    <span class="token keyword">const</span> template<span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'设置'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span><span class="token string">'http://blog.poetries.top'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'帮助'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span><span class="token string">'http://blog.poetries.top/2019/01/06/electron-summary'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'关于'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span><span class="token string">'https://github.com/poetries/yuqing-monitor-electron'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token string">'退出'</span><span class="token punctuation">,</span>
            click<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// BrowserWindow.getFocusedWindow().webContents().send('close-main-window');</span>
                app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> menu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tray<span class="token punctuation">.</span><span class="token function">setContextMenu</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span><span class="token punctuation">;</span>


    tray<span class="token punctuation">.</span><span class="token function">setToolTip</span><span class="token punctuation">(</span><span class="token string">'舆情监控系统'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">//监听关闭事件隐藏到系统托盘</span>
    <span class="token comment" spellcheck="true">// 这里需要注意：在window中才生效，mac下系统默认支持</span>
    <span class="token comment" spellcheck="true">// var win = BrowserWindow.getFocusedWindow();</span>
    <span class="token comment" spellcheck="true">// win.on('close',(e)=>{</span>
    <span class="token comment" spellcheck="true">//         if(!win.isFocused()){</span>
    <span class="token comment" spellcheck="true">//             win=null;</span>
    <span class="token comment" spellcheck="true">//         }else{</span>
    <span class="token comment" spellcheck="true">//             e.preventDefault();  </span><span class="token comment" spellcheck="true">/*阻止应用退出*/</span>

    <span class="token comment" spellcheck="true">//             win.hide(); </span><span class="token comment" spellcheck="true">/*隐藏当前窗口*/</span>

    <span class="token comment" spellcheck="true">//         }       </span>
    <span class="token comment" spellcheck="true">// })</span>

    <span class="token comment" spellcheck="true">// //监听托盘的双击事件</span>
    <span class="token comment" spellcheck="true">// tray.on('double-click',()=>{               </span>
    <span class="token comment" spellcheck="true">//     win.show();</span>
    <span class="token comment" spellcheck="true">// })</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>4. <code>src/main/shortCut.js</code>快捷键配置</strong></p>
<p>在<code>src/main/index.js</code>中引入（<code>require(&#39;src/main/shortCut.js&#39;)</code>）即可，不需要放到<code>app</code>监控中</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> <span class="token punctuation">{</span>globalShortcut<span class="token punctuation">,</span> app<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 注册全局快捷键</span>
    globalShortcut<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'command+e'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// 检测快捷键是否注册成功 true是注册成功</span>
    <span class="token keyword">let</span> isRegister <span class="token operator">=</span> globalShortcut<span class="token punctuation">.</span><span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token string">'command+e'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>isRegister<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 退出的时候取消全局快捷键</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'will-quit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    globalShortcut<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token string">'command+e'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="4-3-渲染进程配置"><a href="#4-3-渲染进程配置" class="headerlink" title="4.3 渲染进程配置"></a>4.3 渲染进程配置</h4><p><strong>1. src/render/main.js配置</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>

<span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">'element-ui'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'element-ui/lib/theme-chalk/index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueHighcharts <span class="token keyword">from</span> <span class="token string">'vue-highcharts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueSocketIO <span class="token keyword">from</span> <span class="token string">'vue-socket.io'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueHighcharts<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//引入socket.io配置连接</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VueSocketIO</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  debug<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  connection<span class="token punctuation">:</span> <span class="token string">'http://118.123.14.36:3000'</span><span class="token punctuation">,</span>
  vuex<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">,</span>
      actionPrefix<span class="token punctuation">:</span> <span class="token string">'SOCKET_'</span><span class="token punctuation">,</span>
      mutationPrefix<span class="token punctuation">:</span> <span class="token string">'SOCKET_'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>IS_WEB<span class="token punctuation">)</span> Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-electron'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span>http <span class="token operator">=</span> Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$http <span class="token operator">=</span> axios
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>


<span class="token comment" spellcheck="true">/* eslint-disable no-new */</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  template<span class="token punctuation">:</span> <span class="token string">'&lt;App/>'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>2. 路由配置src/renderer/router/index.js</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/Home'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/report'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'report'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/Report'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/negativereport'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'negativereport'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/NegativeReport'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/positivereport'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'positivereport'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/PositiveReport'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/keyword'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'keyword'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/KeyWord'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/alarm'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'alarm'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/Alarm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/msg'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'msg'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/components/Msg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
      redirect<span class="token punctuation">:</span> <span class="token string">'/home'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p><a href="https://github.com/poetries/yuqing-monitor-electron/tree/master/src/renderer" target="_blank" rel="noopener">其他页面更多详情Github</a></p>
</blockquote>
<p><strong>3. 在渲染进程中使用主进程方式</strong></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// electron挂载到了vue实例上 $electron</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$electron<span class="token punctuation">.</span>shell
</code></pre>
<h4 id="4-4-多平台打包"><a href="#4-4-多平台打包" class="headerlink" title="4.4 多平台打包"></a>4.4 多平台打包</h4><blockquote>
<p>需要注意的是打包<code>mac</code>版本在<code>mac</code>系统上打包，打包<code>window</code>则在<code>windows</code>上打包，可以避免很多问题</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在不同平台上执行即可打包应用</span>
<span class="token function">npm</span> run build
</code></pre>
<h5 id="4-4-1-打包介绍"><a href="#4-4-1-打包介绍" class="headerlink" title="4.4.1 打包介绍"></a>4.4.1 打包介绍</h5><blockquote>
<p><a href="https://simulatedgreg.gitbooks.io/electron-vue/content/cn/using-electron-packager.html" target="_blank" rel="noopener">electron-vue打包文档</a></p>
</blockquote>
<p><strong>1. electron 中构建应用最常用的模块</strong></p>
<ul>
<li><code>electron-packager</code></li>
<li><code>electron-builder</code></li>
</ul>
<blockquote>
<p><code>electron-packager</code> 和 <code>electron-builder</code>在自己单独创建的应用用也可以完成打包功 能。但是由于配置太复杂所以我们不建议单独配置</p>
</blockquote>
<p><strong>2. electron-forge</strong></p>
<blockquote>
<p><a href="https://github.com/electron-userland/electron-forge" target="_blank" rel="noopener">https://github.com/electron-userland/electron-forge</a></p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">electron-forge package 
electron-forge <span class="token function">make</span>
</code></pre>
<p><strong>3. electron-vue中的打包方式</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># https://simulatedgreg.gitbooks.io/electron-vue/content/cn/using-electron-packager. html</span>
<span class="token comment" spellcheck="true"># 之需要执行一条命令</span>
<span class="token function">npm</span> run build
</code></pre>
<h5 id="4-4-2-修改应用信息"><a href="#4-4-2-修改应用信息" class="headerlink" title="4.4.2 修改应用信息"></a>4.4.2 修改应用信息</h5><p><strong>1. 修改package.json</strong></p>
<p><img src="../../../static/2020/81.png" alt="img"></p>
<p><strong>2. 修改src/index.ejs标题信息</strong></p>
<p><strong>3. 修改build/icons图标</strong></p>
<h5 id="4-4-3-打包遇到的问题"><a href="#4-4-3-打包遇到的问题" class="headerlink" title="4.4.3 打包遇到的问题"></a>4.4.3 打包遇到的问题</h5><p><strong>1. 创建应用托盘的时候可能会遇到错误</strong></p>
<ul>
<li>把托盘图片放在根目录<code>static</code>里面，然后注意下面写法。</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> tray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__static<span class="token punctuation">,</span><span class="token string">'favicon.ico'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>如果托盘路径没有问题，还是包托盘相关错误的话，把托盘对应的图片换成<code>.png</code> 格式重试</li>
</ul>
<p><strong>2. 模块问题可能会遇到的错误</strong></p>
<p><img src="../../../static/2020/82.png" alt="img"></p>
<p><img src="../../../static/2020/83.png" alt="img"></p>
<p><strong>解决办法</strong></p>
<ul>
<li>删掉 <code>node_modules</code> 然后重新用 <code>npm install</code> 安装依赖</li>
<li>用 <code>yarn</code> 来安装模块</li>
<li>用手机创建一个热点电脑连上热点重试</li>
</ul>
<blockquote>
<p>最后执行<code>yarn run build</code>即可</p>
</blockquote>
<p><img src="../../../static/2020/84.png" alt="img"></p>
<blockquote>
<p>项目源码 <a href="https://github.com/poetries/yuqing-monitor-electron" target="_blank" rel="noopener">https://github.com/poetries/yuqing-monitor-electron</a></p>
</blockquote>
<h2 id="十四、更多参考"><a href="#十四、更多参考" class="headerlink" title="十四、更多参考"></a>十四、更多参考</h2><ul>
<li><a href="https://www.electronjs.org/docs" target="_blank" rel="noopener">electron官方文档</a></li>
<li><a href="http://blog.poetries.top/2019/01/06/electron-summary/" target="_blank" rel="noopener">参考博文</a></li>
<li><a href="https://github.com/poetries/electron-wiki" target="_blank" rel="noopener">electron学习资料整理</a></li>
</ul>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.lixl.cn" rel="external nofollow noreferrer">悟尘</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                    </span>
                <span class="reprint-info">
                    <a href="https://www.lixl.cn/2020/021957111.html">https://www.lixl.cn/2020/021957111.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-ND 4.0</a>
                    许可协议，转载请注明来源
                    <a href="https://www.lixl.cn" target="_blank">悟尘记</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Node-js/">
                                    <span class="chip bg-color">Node.js</span>
                                </a>
                            
                                <a href="/tags/Electron/">
                                    <span class="chip bg-color">Electron</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="wechat,weibo,qq,qzone,douban,twitter,facebook,google,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'd032ec0dfbe5a4b4ec6f',
        clientSecret: 'afe793d53f24ebd7f53d0eb4dd21f3bc706dab06',
        repo: 'blog',
        owner: 'lxl80',
        admin: "lxl80",
        id: '2020-02-19T09-59-01',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2020/021957111.html">
                    <div class="card-image">
                        
                        <img src="https://pic.lixl.cn/2020/20200219103814.png/w1280" class="responsive-img" alt="Electron构建跨平台应用">
                        
                        <span class="card-title">Electron构建跨平台应用</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Electron用HTML，CSS和JavaScript来构建跨平台桌面应用程序，将Chromium和Node.js合并到同一个运行时环境中，并将其打包为Mac，Windows和Linux系统下的应用。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/后端/" class="post-category">
                                    后端
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Node-js/">
                        <span class="chip bg-color">Node.js</span>
                    </a>
                    
                    <a href="/tags/Electron/">
                        <span class="chip bg-color">Electron</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/021737756.html">
                    <div class="card-image">
                        
                        <img src="https://pic.lixl.cn/2020/20200217163012.png" class="responsive-img" alt="VSCode-aliyun-oss-paste-image 插件安装使用指南">
                        
                        <span class="card-title">VSCode-aliyun-oss-paste-image 插件安装使用指南</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            VSCode扩展插件，在 Markdown 类型文件编辑过程中，支持一键上传截图到阿里云OSS并将图片粘贴到博文中。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/工具/" class="post-category">
                                    工具
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/VSCode/">
                        <span class="chip bg-color">VSCode</span>
                    </a>
                    
                    <a href="/tags/PasteImage/">
                        <span class="chip bg-color">PasteImage</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 悟尘记<br />'
            + '文章作者: 悟尘<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归 [悟尘](http://lixl.cn) 所有，采用 CC BY-NC-ND 4.0 许可协议，转载请注明来源！';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            &copy;
            <span id="year">2019</span>
            <a href="https://www.lixl.cn" target="_blank">悟尘</a>
            &nbsp;|&nbsp;&nbsp;基于&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> 的
            &nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a> 主题构建
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;&nbsp;<i class="far fa-eye"></i>&nbsp;PV:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;&nbsp;<i class="fas fa-users"></i>&nbsp;UV:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;
            </span>
            
            
            
            &nbsp;|&nbsp;&nbsp;<span id="icp">
                <a href="http://www.beian.miit.gov.cn/" target="_blank">冀ICP备20001325号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lxl80/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:me@lixl.cn" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=369888789" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 369888789" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
